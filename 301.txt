import scrapy
import re

class MySpider(scrapy.Spider):
    name = 'myspider'

    # List of original URLs to modify
    start_urls = [
        "https://www.tripadvisor.com/Restaurants-g123456-Bharatpur_Chitwan_District_Narayani_Zone_Central_Region.html",
        "https://www.tripadvisor.com/Restaurants-g789012-Nepalgunj_Bheri_Zone_Mid_Western_Region.html",
        # Add more URLs here as needed
    ]

    # Regular expression pattern to match the "g" value in the URL
    pattern = re.compile(r"g(\d+)")

    def parse(self, response):
        # Modify the URL 5 times and parse each modified URL
        for i in range(5):
            modified_url = self.modify_url(response.url, i)
            yield scrapy.Request(modified_url, callback=self.parse_modified)

    def parse_modified(self, response):
        # Ignore any modified URL that returns a 301 response
        if response.status == 301:
            self.logger.info(f"Ignoring 301 response for URL: {response.url}")
            return

        # Parse the data from the modified URL
        # ...

        # Return to parse the next modified URL
        # ...

    def modify_url(self, url, i):
        # Use the regular expression to find the "g" value in the URL and replace it with "-or-"
        match = self.pattern.search(url)
        if match:
            modified_url = url[:match.start()] + "-or-" + match.group(1) + url[match.end():]
            return modified_url + f"-{i}" # Add a suffix to the modified URL to distinguish between different versions
        else:
            return url + f"-{i}" # Add a suffix to the original URL to distinguish between different versions
